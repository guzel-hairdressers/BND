# Детектор людей на видео

Программа для детекции людей на видеофайле с использованием модели YOLOv8.
Результатом работы является видео с отрисованными bounding box'ами вокруг каждого обнаруженного человека.

## Установка

1.  Клонируйте репозиторий:
    ```bash
    git clone [https://github.com/guzel-hairdressers/BND.git](https://github.com/guzel-hairdressers/BND.git)
    cd people_detector
    ```

2.  Создайте и активируйте виртуальное окружение:
    ```bash
    python -m venv venv
    source venv/bin/activate  # (для Linux/macOS)
    # venv\Scripts\activate   # (для Windows)
    ```

3.  Установите необходимые зависимости:
    ```bash
    pip install -r requirements.txt
    ```

## Запуск

Поместите ваше видео (`crowd.mp4`) в папку `input`.

Для запуска программы выполните команду:

```bash
python main.py
```

Программа автоматически возьмет видео из `input/crowd.mp4` и сохранит результат в `output/result_crowd.mp4`.

### Параметры запуска

Вы можете указать другие пути и другую модель через аргументы командной строки:

```bash
python main.py --input path/to/your/video.mp4 --output path/to/save/result.mp4 --model yolov8m.pt
```

* `--input`: Путь к исходному видео.
* `--output`: Путь для сохранения результата.
* `--model`: Какую модель YOLOv8 использовать (например, `yolov8n.pt`, `yolov8s.pt`, `yolov8m.pt`).

## Анализ качества распознавания

Текущая реализация представляет собой двухпроходный алгоритм, использующий предобученную модель YOLOv8s для детекции (Проход 1) и кастомный трекер на основе Венгерского алгоритма (для матчинга ID) и линейной интерполяции (LERP) для отрисовки (Проход 2).

Положительные стороны:

Устойчивость ID: Благодаря Венгерскому алгоритму и параметру max_age_frames, трекер успешно сохраняет ID объектов даже после кратковременных окклюзий (перекрытий) или пропусков детекции.

Скорость: Детекция (самая тяжелая операция) выполняется только на N-х кадрах, что значительно ускоряет общую обработку.

Фильтрация: conf_threshold и iou_threshold позволяют гибко настраивать баланс между ложными срабатываниями (False Positives) и пропусками (False Negatives).


## Шаги по дальнейшему улучшению

Ключевым улучшением является переход на 3-проходную архитектуру, которая полностью решит проблему "прыжков":

Проход 1: Детекция (как сейчас). Сбор всех детекций с ключевых кадров в keyframe_detections.

Проход 2: Планирование (БЕЗ видео). Отдельный цикл, который итерирует только по keyframe_detections (кадры 0, 10, 20...). Он выполняет всю логику трекинга (Hungarian, max_age) и создает мастер-список всех LERP-заданий (all_lerp_tasks) для всего видео. Каждое задание — это (track_id, start_frame, end_frame, start_box, end_box).

Проход 3: Отрисовка (как сейчас). Снова читает видео с 0-го кадра. На каждом кадре (0, 1, 2, 3...) он смотрит в all_lerp_tasks, находит активные задания, вычисляет t и отрисовывает плавную интерполяцию.

### Прочие улучшения:

Повышение Recall: Использование более тяжелой модели (YOLOv8m или YOLOv8l) для повышения полноты детекции, особенно для мелких или частично перекрытых объектов, ценой снижения скорости Прохода 1.